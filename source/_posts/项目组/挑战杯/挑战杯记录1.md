---
title: 挑战杯记录1
tags:
  - - 挑战杯
  - - DPDK
  - - Suricata
  - - 入侵检测
categories:
  - - 项目组
    - 挑战杯
abbrlink: a2531f57
date: 2021-09-30 13:04:41
---

> 最近一两个月主要在做之前参加的挑战杯专项赛，中国电信的题目，做IPS。
>
> 关于比赛记录一些内容。有些技术成果不便分享。其他的一些内容可参见Categories中[[项目组, Suricata/DPDK]](https://leex0.top/categories/)。

## 比赛内容

简单来说：`在国产平台(比赛是鲲鹏+麒麟)，基于Suricata做一个入侵防御系统，需要具有比较大的流量负载能力，和对一些恶意流量能够识别拦截`。

大流量下还有一些分片之类的变形，仍需要能够负载和识别拦截。

流量是给了pcap和csv说明，照着一个一个写对应的规则就可以。

## 技术方案

主要用DPDK和Suricata结合，DPDK负责大流量的转发，Suricata用写的和收集的规则负责检测。最后结合日志做一个WEB界面。

## 工作内容

1. DPDK+Suricata结合并在国产平台运行

参考了一些别的DPDK+Suricata结合的项目，了解基本程序运行和结合逻辑。最终在尝试多个版本后**确定使用的版本**。

在国产平台上编译运行也遇到不少问题，主要是**依赖、驱动、库兼容性的问题**解决。

2. 编写规则

对所有的恶意数据流分析之后，还是需要写不少规则，熟悉完规则编写语法，对照着已有的规则，分工进行规则编写。

每次一轮编写完成，重放恶意流量，查看流量是否识别到拦截下来，对没有识别好的流量继续优化规则。最后一共筛了几遍规则，形成了**针对性的恶意流量规则集**。

此外还添加了**精选的现有规则**。默认的规则集条目非常多，检测很慢影响效率。对默认规则进行精简，留下了数量合适的现有规则，合并自己的规则集使用。

3. 界面

界面主要是**针对Suricata的配置文件、规则管理、日志文件写一些接口**，使其能够正确的在前端进行查看与配置。

4. 调参

默认的Suricata参数对于大流量的负载能力一般，需要**针对测试环境进行参数调整**来获取更好的性能。

> 本次主要调整的参数如下：
>
> - 针对NUMA环境分配CPU数量
>
> - 调整数据流的超时限制
>
> - 对数据流与会话预分配内存，使用大页内存提高缓存效率
>
> - 调整分片重组的深度限制，在保证负载的情况下尽量对更多的分片进行检测

## 测试结果

## 测试结果

|     测试项     |          测试结果           |
| :------------: | :-------------------------: |
|     检测率     |             98%             |
|     误截率     |             0%              |
| 单10G网卡吞吐  |      9G——阻断率99.41%       |
| 双10G网卡吞吐  |     20G——阻断率82.514%      |
|    小包吞吐    |          8.196Gbps          |
| 新建连接数吞吐 | 16.15万flow/s——阻断率74.86% |
