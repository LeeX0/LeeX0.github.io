---
title: 20210826组会
tags:
  #Suricata
  #rules
date: 2021-08-25 17:33:34
---

## 规则编写
### attack info
| 6.992031  | Microsoft IIS: WebHits Authentication  Bypass  (https://strikecenter.ixiacom.com/bps/strikes/exploits/iis/webhits_auth_bypass.xml) | TCP 1.1.204.70:30991->1.2.200.96:80  | CVE 2007-2815  (http://cve.mitre.org/cgi-bin/cvename.cgi?name=2007%2d2815)BID 24105  (http://www.securityfocus.com/bid/24105)CVSS-Critical  (https://nvd.nist.gov/cvss.cfm)CWE-264  (https://cwe.mitre.org/data/definitions/264.html) |
| --------- | ------------------------------------------------------------ | ------------------------------------ | ------------------------------------------------------------ |
| 14.337709 | RealVNC 4.1.1 Authentication Bypass  (https://strikecenter.ixiacom.com/bps/strikes/exploits/vnc/realvnc_41_bypass.xml) | TCP 1.1.172.141:17060->1.2.171.53:5900                              | CVE 2006-2369  (http://cve.mitre.org/cgi-bin/cvename.cgi?name=2006%2d2369)BID 17978  (http://www.securityfocus.com/bid/17978)CVSS-High  (https://nvd.nist.gov/cvss.cfm)CWE-287  (https://cwe.mitre.org/data/definitions/287.html) |
| 10.105118 | UNIX rlogind Service -froot Authentication Bypass  (https://strikecenter.ixiacom.com/bps/strikes/exploits/rservices/rlogin_froot.xml) | TCP 1.1.9.176:800->1.2.14.71:513     | CVE 1999-0113  (http://cve.mitre.org/cgi-bin/cvename.cgi?name=1999%2d0113)BID 458  (http://www.securityfocus.com/bid/458)CVSS-Critical  (https://nvd.nist.gov/cvss.cfm) |
| 10.591573 | UNIX rlogind Service guest Access  (https://strikecenter.ixiacom.com/bps/strikes/exploits/rservices/rlogin_guest.xml) | TCP 1.1.219.186:800->1.2.198.237:513 | http://www.faqs.org/rfcs/rfc1258.html  (http://www.faqs.org/rfcs/rfc1258.html)CVSS-Moderate  (https://nvd.nist.gov/cvss.cfm) |
| 10.907336 | UNIX rlogind Service root Account Access  (https://strikecenter.ixiacom.com/bps/strikes/exploits/rservices/rlogin_root.xml) | TCP 1.1.230.110:800->1.2.85.170:513  | http://www.faqs.org/rfcs/rfc1258.html  (http://www.faqs.org/rfcs/rfc1258.html)CVSS-Critical  (https://nvd.nist.gov/cvss.cfm) |
| 10.915637 | UNIX rlogind Service nobody Access  (https://strikecenter.ixiacom.com/bps/strikes/exploits/rservices/rlogin_nobody.xml) | TCP 1.1.92.116:800->1.2.95.132:513   | http://www.faqs.org/rfcs/rfc1258.html  (http://www.faqs.org/rfcs/rfc1258.html)CVSS-Moderate  (https://nvd.nist.gov/cvss.cfm) |
### Microsoft IIS: WebHits Authentication  Bypass——CVE-2007-2815(sid:40067)

> 纯`HTTP`，流量拦截成功

```json
# 攻击流量
GET /Pvd/null.htw?CiWebhitsfile=/IzWqEzx/DAKfXw.asp&CiRestriction=b&CiHiliteType=full HTTP/1.1
Host: KZrNlogFbyMHvAhwzsETVIAsqnUSGWR
User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; en-GB)
Accept: 
Connection: keep-alive

# 规则内容
drop http any any -> any any (msg:"Microsoft IIS: WebHits Authentication  Bypass";flow:established,to_server;http.uri;content:".htw?"; nocase;content:"CiWebhitsfile=";nocase;reference:cve,CVE-2007-2815;reference:url,cve.mitre.org/cgi-bin/cvename.cgi?name=2007%2d2815)BID;reference:url,www.exploit-db.com/exploits/4016;classtype:web-application-attack;sid:40067;metadata:attack_target Web_Server, created_at 2021_08_20, updated_at 2021_08_20;)
```

### UNIX rlogind Service -froot Authentication Bypass——CVE-1999-0113

> `Suricata`与`snort`中均存在对应规则，规则内容相同且与流量对应，但未拦截。
> sid:2100604;
> sid:2100609;

```json
# 攻击流量
@-froot@-froot@sh@@

# 规则内容
alert tcp any any -> any any (msg:"GPL EXPLOIT rsh froot"; flow:to_server,established; content:"-froot|00|"; fast_pattern; reference:arachnids,387; classtype:attempted-admin; sid:2100604; rev:7; metadata:created_at 2010_09_23, updated_at 2019_10_07;)

alert tcp any any -> any any (msg:"GPL MISC rsh froot"; flow:to_server,established; content:"-froot|00|"; reference:arachnids,387; classtype:attempted-admin; sid:2100609; rev:6; metadata:created_at 2010_09_23, updated_at 2010_09_23;)

# Snort
alert tcp $EXTERNAL_NET any -> $HOME_NET 513 (msg:"PROTOCOL-SERVICES Unix rlogin froot parameter root access attempt"; flow:to_server,established; content:"-froot|00|"; fast_pattern:only; metadata:ruleset community; reference:bugtraq,458; reference:cve,1999-0113; reference:url,osvdb.org/show/osvdb/1007; classtype:attempted-admin; sid:604; rev:12;)
```
![[Pasted image 20210825180710.png]]

### UNIX rlogind Service guest Access(sid:40068)

```json
# 攻击流量
@guest@guest@xterm/38400@@

# 规则内容
drop tcp any any -> any any (msg:"UNIX rlogind Service guest Access";flow:established,to_server;content:"guest|00|guest";classtype:attempted-user;sid:40068;metadata:created_at 2021_08_20, updated_at 2021_08_20;)
```

### UNIX rlogind Service nobody Access(sid:40069)

```json
# 攻击流量
@nobody@nobody@xterm/38400@@

# 规则内容
drop tcp any any -> any any (msg:"UNIX rlogind Service nobody Access";flow:established,to_server;content:"guest|00|guest";classtype:attempted-user;sid:40069;metadata:created_at 2021_08_20, updated_at 2021_08_20;)
```

### UNIX rlogind Service root Account Access(sid:40070)

```json
# 攻击流量
@root@root@xterm/38400@@

# 规则内容
drop tcp any any -> any any (msg:"UNIX rlogind Service root Account Access";flow:established,to_server;content:"root|00|root";classtype:attempted-admin;sid:40070;metadata:created_at 2021_08_20, updated_at 2021_08_20;)
```

### RealVNC 4.1.1 Authentication Bypass——CVE-2006-2369

> flow
>
> sid:2002912; sid:2002913;
> sid:2002914; sid:2002918; sid:2002924; sid:2002923;
> sid:2002919; sid:2002915; sid:2002916; sid:2002917; sid:2002921;

```json
# 攻击流量
RFB 003.008
RFB 003.008
@@@@

# 规则触发流
sid:2002912 -> sid:2002913 -> sid:2002918 -> sid:2002916 -> sid:200291

# 规则内容
alert tcp any any -> any any (msg:"ET EXPLOIT VNC Possible Vulnerable Server Response"; flow:established; dsize:12; content:"RFB 003.00"; depth:11; flowbits:noalert; flowbits:set,BSposs.vuln.vnc.svr; reference:url,www.realvnc.com/docs/rfbproto.pdf; reference:cve,2006-2369; reference:url,doc.emergingthreats.net/bin/view/Main/2002912; classtype:misc-activity; sid:2002912; rev:7; metadata:created_at 2010_07_30, updated_at 2010_07_30;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"ET EXPLOIT VNC Client response"; flowbits:isset,BSposs.vuln.vnc.svr; flow:established; dsize:12; content:"RFB 003.0"; depth:9; flowbits:noalert; flowbits:set,BSis.vnc.setup; reference:url,www.realvnc.com/docs/rfbproto.pdf; reference:url,doc.emergingthreats.net/bin/view/Main/2002913; classtype:misc-activity; sid:2002913; rev:7; metadata:created_at 2010_07_30, updated_at 2010_07_30;)

alert tcp any any -> any any (msg:"ET EXPLOIT VNC Server VNC Auth Offer"; flowbits:isset,BSis.vnc.setup; flow:established; dsize:20; content:"|00 00 00 02|"; depth:4; flowbits:noalert; flowbits:set,BSvnc.auth.offered; reference:url,www.realvnc.com/docs/rfbproto.pdf; reference:url,doc.emergingthreats.net/bin/view/Main/2002914; classtype:misc-activity; sid:2002914; rev:6; metadata:created_at 2010_07_30, updated_at 2010_07_30;)
alert tcp any any -> any any (msg:"ET EXPLOIT VNC Server VNC Auth Offer - No Challenge string"; flowbits:isset,BSis.vnc.setup; flow:established; dsize:2; content:"|01 02|"; depth:2; flowbits:noalert; flowbits:set,BSvnc.auth.offered; reference:url,www.realvnc.com/docs/rfbproto.pdf; reference:url,doc.emergingthreats.net/bin/view/Main/2002918; classtype:misc-activity; sid:2002918; rev:6; metadata:created_at 2010_07_30, updated_at 2010_07_30;)
alert tcp any any -> any any (msg:"ET EXPLOIT VNC Server Not Requiring Authentication"; flowbits:isset,BSis.vnc.setup; flow:established; content:"|01 01|"; depth:2; flowbits:set,BSvnc.auth.offered; flowbits:unset,BSis.vnc.setup; flowbits:unset,BSvnc.auth.offered; reference:url,www.realvnc.com/docs/rfbproto.pdf; reference:cve,2006-2369; reference:url,doc.emergingthreats.net/bin/view/Main/2002924; classtype:misc-activity; sid:2002924; rev:7; metadata:created_at 2010_07_30, updated_at 2010_07_30;)
alert tcp any any -> any any (msg:"ET EXPLOIT VNC Server Not Requiring Authentication (case 2)"; flowbits:isset,BSis.vnc.setup; dsize:4; flow:established; content:"|00 00 00 01|"; depth:4; flowbits:set,BSvnc.auth.offered; reference:url,www.realvnc.com/docs/rfbproto.pdf; reference:cve,2006-2369; reference:url,doc.emergingthreats.net/bin/view/Main/2002923; classtype:misc-activity; sid:2002923; rev:6; metadata:created_at 2010_07_30, updated_at 2010_07_30;)

alert tcp any any -> any any (msg:"ET EXPLOIT VNC Good Authentication Reply"; flowbits:isset,BSvnc.auth.offered; flow:established; dsize:2; content:"|02|"; flowbits:unset,BSvnc.auth.offered; flowbits:noalert; flowbits:set,BSvnc.auth.agreed; reference:url,www.realvnc.com/docs/rfbproto.pdf; reference:url,doc.emergingthreats.net/bin/view/Main/2002919; classtype:attempted-admin; sid:2002919; rev:7; metadata:created_at 2010_07_30, updated_at 2010_07_30;)
alert tcp any any -> any any (msg:"ET EXPLOIT VNC Authentication Reply"; flowbits:isset,BSvnc.auth.offered; flow:established; dsize:16; flowbits:unset,BSvnc.auth.offered; flowbits:noalert; flowbits:set,BSvnc.auth.agreed; reference:url,www.realvnc.com/docs/rfbproto.pdf; reference:url,doc.emergingthreats.net/bin/view/Main/2002915; classtype:attempted-admin; sid:2002915; rev:6; metadata:created_at 2010_07_30, updated_at 2010_07_30;)
alert tcp any any -> any any (msg:"ET EXPLOIT RealVNC Authentication Bypass Attempt"; flowbits:isset,BSvnc.auth.offered; flow:established; dsize:1; content:"|01|"; depth:1; flowbits:set,BSvnc.null.auth.sent; reference:url,secunia.com/advisories/20107/; reference:url,archives.neohapsis.com/archives/fulldisclosure/2006-05/0356.html; reference:cve,2006-2369; reference:url,doc.emergingthreats.net/bin/view/Main/2002916; classtype:attempted-admin; sid:2002916; rev:6; metadata:created_at 2010_07_30, updated_at 2010_07_30;)
alert tcp any any -> any any (msg:"ET EXPLOIT RealVNC Server Authentication Bypass Successful"; flowbits:isset,BSvnc.null.auth.sent; flow:established; dsize:4; content:"|00 00 00 00|"; depth:4; flowbits:unset,BSis.vnc.setup; flowbits:unset,BSvnc.auth.offered; reference:url,secunia.com/advisories/20107/; reference:url,archives.neohapsis.com/archives/fulldisclosure/2006-05/0356.html; reference:cve,2006-2369; reference:url,doc.emergingthreats.net/bin/view/Main/2002917; classtype:successful-admin; sid:2002917; rev:6; metadata:created_at 2010_07_30, updated_at 2010_07_30;)
alert tcp any any -> any any (msg:"ET EXPLOIT VNC Multiple Authentication Failures"; flowbits:isset,BSvnc.auth.agreed; flow:established; dsize:<50; content:"|00 00 00 02|"; depth:4; reference:url,www.realvnc.com/docs/rfbproto.pdf; reference:url,doc.emergingthreats.net/bin/view/Main/2002921; classtype:attempted-admin; sid:2002921; rev:6; metadata:created_at 2010_07_30, updated_at 2010_07_30;)

# snort
# alert tcp any any -> any any (msg:"DELETED EXPLOIT RealVNC client response"; flow:established,to_server; dsize:12; content:"RFB 00"; depth:6; flowbits:set,vnc.pv.setup; flowbits:set,vnc.vul.setup; flowbits:noalert; reference:bugtraq,17978; reference:cve,2006-2369; reference:url,www.realvnc.com/docs/rfbproto.pdf; classtype:misc-activity; sid:13611; rev:5;)
# alert tcp any any -> any any (msg:"DELETED EXPLOIT RealVNC server authentication bypass attempt"; flow:established; flowbits:isset,vnc.vul.setup; dsize:1; content:"|01|"; depth:1; flowbits:unset,vnc.vul.setup; reference:bugtraq,17978; reference:cve,2006-2369; reference:url,www.realvnc.com/docs/rfbproto.pdf; classtype:misc-activity; sid:13612; rev:5;)
# alert tcp any any -> any any (msg:"DELETED EXPLOIT RealVNC server authentication version array check"; flow:to_client; flowbits:isset, vnc.vul.setup; content:"|01|"; offset:1; flowbits:unset,vnc.vul.setup; flowbits:noalert; reference:bugtraq,17978; reference:cve,2006-2369; reference:url,www.realvnc.com/docs/rfbproto.pdf; classtype:misc-activity; sid:13880; rev:3;)
# alert tcp any any -> any any (msg:"SERVER-OTHER RealVNC password authentication bypass attempt"; flow:to_server,established; flowbits:isset,vnc.server.auth.types; flowbits:unset,vnc.server.auth.types; dsize:1; byte_test:1,=,1,0; metadata:policy max-detect-ips drop, service vnc-server; reference:bugtraq,17978; reference:cve,2006-2369; classtype:attempted-admin; sid:6471; rev:11;)

```

![[Pasted image 20210825175822.png]]

## 规则重载
[[Suricata规则重载问题解决]]
