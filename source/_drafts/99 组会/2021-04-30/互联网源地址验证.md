# 互联网源地址验证

[TOC]

## 1 背景需求

当前，互联网是**基于目的地址转发，对源地址不作验证**。

 而互联网很多安全问题的根源在于**源地址的不可信**。另一方面，随着互联网规模和复杂度的增大以及对政治、经济利益影响的加深，域间路由系统对互联网的稳定运行起着愈发关键的作用。

 美国国土安全部将域间路由安全问题列入了美国信息安全的国家战略。

 近年来，**以IP源地址伪造为主要方式的分布式拒绝服务攻击不断地对互联网的安全性和可用性造成极大的破坏**，这其中，以跨越多个管理域和国家的攻击最为频繁。因此，建立以自治域为单位的源地址验证防御体系，对互联网的安全意义重大。

## 2 意义

### 2.1 对使用者的意义

1. **抵御域外流量攻击**

相比于针对域内的安全防御措施, 抵御域外的伪造源地址攻击无疑是自治域更加迫切的需求。由于自治域对域内网络有着较为全面的控制权, 域内的相互攻击更容易得到及时的发现和控制, 而来自外域的攻击在没有得到域间协作的基础上抵御难度极大。因此, 建立有效的域间源地址验证技术, 是自治域实现对域内保护的重要环节。

2. **降低成为反射点的概率**

由于反射攻击的存在, 伪造源地址报文的目的地可能是攻击的反射点而非攻击目标。在该环境下, 自治域内的公开服务均可能被攻击者利用并作为反射点进行汇聚和放大。部署域间源地址验证可以降低自治域被作为反射点的概率, 避免被攻击者栽赃陷害, 也能降低其他自治域因反射而被攻击的概率。

3. **降低其他自治域被攻击的概率**

由于域间流量往往流经多个自治域后才能到达目的地, 倘若流量流经的自治域中存在域间源地址验证技术, 则伪造源地址流量被过滤的概率将有所增加, 因而目的自治域被攻击的概率将有所下降。通过部署域间源地址验证技术, 部署自治域将降低其他自治域被攻击的概率, 进而为其他自治域提供保护。

### 2.2 对互联网体系结构的意义

1. **提升互联网的可管理性**

防御域间伪造源地址攻击是互联网安全可信的重要保障:一方面, 其为数据通信提供安全性保障, 这使得非法的通信可被拒绝访问, 可疑的通信可被溯源追查。此外, 真实的报文源地址使得防火墙和其他访问控制设备可以对出入域报文基于真实IP地址进行精细化的管理和控制, 提升了网络管理的灵活性, 降低了管理的复杂性。

2. **提升互联网的稳定性**

由于互联网的分布式特性, 在缺失域间防御策略的环境下, 伪造源地址报文从某一自治域发往网络中的其他节点时, 势必会对其造成破坏并使得整个网络稳定性失衡。构建出完整的域间防御体系, 将使伪造报文仅仅停留在报文发起的自治域本身, 攻击带来的影响不会向互联网中继续扩散, 这使得分布式的网络架构具有更强的稳定性。

3. **为基于IPv6的地址技术创新提供保证**

IPv6的巨大地址空间为体系结构层面的技术创新提供了平台, 而基于IPv6地址空间的技术创新需要以真实源地址为基础。利用IPv6网络更新换代的历史时机, 从现在起严格按照区域类型和业务类型甚至用户类型进行地址分配, 可使用户身份信息与IP地址的耦合更加紧密, 也为用户身份识别与信息溯源提供了重要基础。

## 3 相关技术

### 3.1 基于加密、签名及标记信息

#### 3.1.1 技术原理

针对基于加密、签名和标记信息的域间源地址验证技术而言, 研究通常采用**端到端特征验证**的设计结构。这种结构并非均以自治域作为设计单元, 但仍可对域间环境做出大量优化改进。其中, **端到端特征验证以密钥协商最为常见**。通信双方在事前协商可供彼此验证的校验标识, 并将其加载在通信过程中的数据报文内以供接收方进行身份确认。若接收方验证通过, 则判定通信对端真实而接收报文; 否则, 视其为伪造而丢弃报文。

典型方案有`SPM(spoofing prevention method)、DISCS(distributed collaboration system)、MIEF`。

#### 3.1.2 技术特点

由于此类方法应用的**安全性即采用加密技术的安全性**, 因此, 增强加密系统的破解难度并降低密钥被破解后造成的损失程度, 是采取此类方法时所需考虑的重点。综合分析此类源地址验证技术的原理及优劣, 其主要技术**难点在于设计安全、高效的标签协商方案**, 即, 端到端特征协商方案, 避免协商过程中的脆弱性而引发出相应的安全攻击。此外, 密钥协商的复杂性使得此类方案在大规模部署时具有较大的维护开销, 可扩展性受限, 制约了其实用价值。

基于加密、签名和标记信息的域间源地址验证技术的**优势在于不受网络拓扑动态性影响**, 过滤性能仅与拟采用加密算法的验证特征相关, 且不具备固有假阳性, 极大地规避了自治域部署的运维风险。然而, 由于通信双方的数据报文不可避免地需要携带验证所需的特征信息, 这使得**数据平面产生了额外的通信开销**。并且, 过多的对端校验开销使其方案本身也极易成为DDoS的攻击目标, 因而造成网络拥塞甚至服务瘫痪; 而伪造源地址报文的过滤通常仅在通信对端执行, 且在网络传输的过程中仍消耗着网络带宽, 并未避免网络带宽资源的消耗浪费。

### 3.2 基于域间路由信息

#### 3.2.1 技术原理

基于路由信息的源地址验证技术, 其绝大部分可以针对域间体系做出优化设计。此类方案的设计思想在于:攻击者仅能伪造数据报文的源地址信息而不能控制报文的转发路径, **当伪造源地址的数据报文从非法的路由端口进入时, 路由器可进行真伪性验证以过滤伪造报文**。DPF(distributed packet ﬁltering)作为路由过滤技术的方案框架, 描绘了以路由器为过滤核心的技术蓝图。DPF通过对各个路由器的各转发端口建立合法源地址绑定列表, 并对转发过程中接收到的绑定列表范围之外的源地址报文判伪并丢弃。

典型方案有`IDPF(inter-domain packet filtering)、SN(selection notice)、uRPF`等。

> 举例说明：
>
> `uRPF单播逆向路径转发`
>
> uRPF技术，是网络设备检查数据包源地址合法性的一种方法。其**在路由表中查找该源地址是否与数据包的来源接口相匹配，如果没有匹配表项将丢弃该数据包**，从而起到预防IP欺骗，特别是针对虚假IP源地址的拒绝服务（DoS）攻击非常有效。
>
> URPF对报文源地址的合法性检查分为***严格（strict）型***和***松散（loose）型***两种：
>
> - 严格型URPF
>
>   不但要求路由器转发表中，存在去往报文源地址的路由；而且还要求报文的入接口与转发表中去往源地址路由的出接口一致，只有同时满足上述两个条件的报文，才被认为是合法报文。
>
> - 松散型URPF
>
>   仅要求路由器的转发表中，存在去往报文的源地址路由即可，不再检查报文的入接口与转发表中去往源地址的路由的出接口是否一致。当用户网络中存在非对称路径等无法保证报文入接口和设备去往源地址路由出接口一致的情况下，可以配置松散型URPF检查。
>
> 诸如TCP Syn Flood、UDP flood 和ICMP flood等攻击，都可能通过借助源地址欺骗的方式攻击目标设备或者主机，造成被攻击者系统性能严重的降低，甚至导致系统崩溃。uRPF技术都能很好的预防。
>
> **但在网络环境比较复杂的情况比如有`非对称路由存在的情况`下效果就可能不好。**
>
> <img src="/Users/buddyholly/Library/Application Support/typora-user-images/image-20210422150859516.png" alt="image-20210422150859516" style="zoom: 25%;" />
>
> **uRPF等技术主要是在单点构建源地址验证表，但当存在路由不对称情况时，验证准确性就难以得到保障**。

#### 3.2.2 技术特点

建立基于域间路由信息的过滤技术需要依赖两项基本因素以建立过滤规则。

1. 获取自治域号对所持前缀的合法映射

2. 获取源端路由选择信息

在能够确保获取生成过滤规则的两项必备要素的前提下, 生成验证规则并不是难事。不同于基于加密、签名及标记信息的源地址验证技术, 基于域间路由信息的源地址验证方法能够**使伪造报文在传输途中被尽早过滤, 从而保护了带宽资源的有效利用**, 其分布式的验证机制也要求验证规则必须根据路由变化而改变, 因此具备较强的自适应性。然而, **此类源地址验证技术通常需要广泛的部署才能够取得较佳的过滤性能**, 而过滤规则的建立受到路由动态性的影响, 若其未能**及时适应新的路由变化**而更新过滤规则, 将会产生较为明显的假阳性及假阴性。

### 3.3 基于IP分组转发经历跳数

#### 3.3.1 技术原理

基于IP分组转发经历跳数的验证技术特指跳数计数过滤(`hop count filtering`, 简称HCF)。HCF不同于上述两类源地址验证技术, 它巧妙地利用了报文TTL(time-to-live)剩余跳数的可行性范围来确立对端实体的合法性。由于通信双方的数据报文具备较为统一的转发路径, 因此也应具备相对稳定的路由跳数。通信接收端在接受报文前对报文已转发跳数进行计算, 若对于特定的通信源地址而言, **其报文跳数在合理的范围之内, 则可相信其在很大程度上未被伪造**。

#### 3.3.2 技术特点

HCF的特征在于将验证执行的位置移至通信主机, 并未针对域间而进行设计优化。而为了减小拓扑震荡时产生的误判, HCF仅能保持较粗的过滤粒度, **过滤能力相对有限**。尽管HCF消除了密码学带来的庞大计算开销, 但其并不能取代为其提供的更为严密的安全保障。另一方面, **互联网同样不对TTL的伪造执行任何检查**, 使其验证技术在得到攻击者足够“重视”后可以被彻底绕过。因此, HCF作为一种**轻量级的过滤技术仅能作为辅助防护**, 并不能作为核心安全技术应用在过滤防护策略之中。

### 3.4 基于自治域间商业互联关系

#### 3.4.1 技术原理

当网络流量穿越某一自治域时, 自治域将至少从流量的某一端受益, 即, 不提供任何无偿的穿越服务。正是因为这样的具备极强商业性质的域间特征, 使得自治域不会将其所有的路由信息毫无保留地向外宣告, 每个自治域只会对特定邻居宣告能够从中攫取收益的路由通告, 这使得能够在自治域之间传递合法流量路径的可行性空间大幅度缩小**。即自治域仅对收通过费的流量放行**。

正是因为受到自治域商业关系的启发, 以域间互联关系作为过滤基础的防御方法开始在学术界提出。由于商业关系是域间路由流量流向的最终本质, 以自治域商业关系为基础的过滤方案相比其他方案更加精炼和简要。由于其仅从商业关系出发构建过滤策略, 使得方案的部署将不受任何因域间路由缺陷而产生的固有限制或束缚, 两者相互独立亦相互配合, 防伪过滤在先, 寻址转发在后, 共同构建出相互并列的整套分布式域间协作系统。

据目前所知, 纯粹以自治域间商业互联关系为基础建立的防御系统仅存在`Arbif`一种技术, 此类验证技术有待于进一步细化和完善。**Arbif运行模式与域间路由协议BGP存在共同之处, 它以自治域商业合作关系为基础**, 在相邻部署自治域内传递过滤规则。部署自治域在启动防御技术时, 其过滤规则生成引擎在其邻居之间建立通信连接, 生成初始过滤规则, 并根据商业关系导出表选择性地将部分过滤规则传递给特定的部署邻居。

#### 3.4.2 技术特点

此类方案的难点在于**如何获取完整的域间商业关系**。在目前的商业协商环境下, 互联关系仍然是自治域间的重要商业机密, 在未得到完整的解决方案之前, 任何自治域都不愿意将此商业机密与第三方共享, 以免造成额外的损失。如何在最小代价范围内使自治域之间共享商业信息并以此建立防御基础, 是此类方案的研究重点, 这需要标准化、商业激励等综合因素的共同作用才能达成良好的新型互助模式。

由于基于自治域商业关系的过滤方法采用分布式的验证机制, 过滤规则将随商业关系变化而动态更新, 具备良好的自适应能力。从本质上获取域间流量的合法途径使其规避了BGP存在的诸多问题, 且能够使得报文在传输路径中被尽早地过滤, 具备更为良好的可扩展性和部署能力。但在此体系环境下, 防御技术仍需广泛部署才能取得良好的过滤效能, 而构建完整的、与路由体系相互补充的防御系统无疑需要更加完整的设计方案和部署激励策略, **同时也需要国际标准化组织的支持才能取得长足的发展**。

#### 技术对比

![image-20210427150729003](/Users/buddyholly/Library/Application Support/typora-user-images/image-20210427150729003.png)

> 假阴性:是指对伪造报文的漏判率。假阴性代表过滤方案的过滤效能的高低, 表征方案的辨伪能力;
>
> 假阳性:是指对合法报文的误判率。假阳性代表过滤方案的部署风险代价, 表征方案的可靠性。

## 4 面临的挑战

#### 协议设计存在缺陷

在域间源地址验证防御方法的设计指导思想中, 低风险、低开销以及高回报是评估协议的重要因素, 然而, 在已发表的学术成果中, 尚未有任何一种方法能够三者兼顾。在源地址验证方案的设计中, 存在两个重要的方案评估指标:假阴性与假阳性。

由于错误地过滤合法报文将极大地降低自治域的服务质量, **一般情况下, 自治域几乎不会考虑部署具有较高假阳性的过滤方案, 但却能够容忍具有一定假阴性的验证方案**。由于没有任何一种技术方案能够在各项评估指标中独揽大局, 因此还没有一项技术得到广泛认可或成为国际技术标准。由于没有国际标准支持, 网络设备厂商无法实现通用的域间过滤协议。而目前很多的过滤方法还需要修改主机协议栈, 在没有标准支持的情况下, 寻求厂商支持的可能性难度极大, 即使部分部署, 也很难产生预期的过滤效果。

#### 自治域间合作困难

由于单个自治域无法获取整个互联网的路由信息, 因此也难以在缺乏有效信息协作的环境下构建误判率为0的过滤方案。为了建立更加完善的过滤技术, 不可避免地需要自治域间的相互合作, 通过传递过滤规则相关的必要信息, 以求在降低假阳性的同时降低假阴性的比例。然而, **由于商业与利益关系的阻隔, 自治域间普适性的合作难以存在**。其中, 商业竞争与政治互斥是自治域实体之间的主要隔阂。商业竞争的自治域需要在互联网中抢占更多的用户及商业资源, 而若要达成合作共识, 则需交互大量的商业信息, 而这其中的很大部分对于自治域而言仍属于商业机密。因此, 要在相互竞争的自治域之间共享商业机密信息难度极大。而对于政治主张相斥的国家或宗教, 其建立合作同盟关系将不低于两个商业竞争的自治域实体, 甚至建立基本可靠的路由系统都不能得到切实保障。

#### 协议开销过重

在目前可行的方案中, **绝大部分需要增加极大的运维开销, 部分方案带来的开销甚至远大于其服务性能得到的提**升; 而对于部分具有固有假阳性(高误判率)或过滤能力不佳(高漏判率)的技术方案, 还会影响到已有的服务质量。因此, 对于任何运营商, 部署这样一套源地址验证方案都将面临巨大的开销代价。一般会按照以下3种分类方法进行分类:根据处理平面分类、根据开销性质分类以及根据开销类型分类。对开销代价多维空间进行拆解, 并从各个维度独立展示了方案部署的开销空间。

从处理平面的角度分析, 基于加密、签名和标记信息的源地址验证方案相较于基于域间路由信息方案而言, 其数据平面和控制平面的开销均较高; 从开销类型的角度分类, 前者相较于后者具备更多的带宽开销和计算开销; 从开销性质的角度分类, 两者均存在不同程度的部署开销和维护开销。

#### 缺乏部署激励

对于大多数域间源地址过滤方案而言, 在防御效能评价之前往往都对部署率有着过于乐观的评估, 甚至存在部分方案需在全局部署的环境下才能取得预期的过滤效能的现象, 但这在真实的互联网世界中是不具备实际执行力的。此外, 部分验证方案对单一自治域在特定部署率环境下缺乏部署激励, 即:从新增的部署节点角度出发, 其部署后带来的过滤效能提升将随着部署率的增大而逐渐下降, 这使得越晚部署的自治域部署激励越来越低, 缺乏良性的激励推动方案的持续部署, 影响其实际执行效能。另一方面, 某些方案的过滤策略使得一些未部署节点能够间接地得到过滤保护, 甚至在未部署的情况下得到不弱于部署节点的过滤效能, 基于自治域作为商业实体的行为特征, 这样的域间源地址验证方案推广将面临更大的阻力**, “不劳而获”使得更多的自治域处于按兵不动、坐享其成的“被动”局面**。

#### 综上

综上所述, 域间源地址验证未能得到实际部署的原因可归结为**效用与利益失衡**。互联网服务提供商的投资都希望得到与之相比更多的回报, 但目前的验证技术未能均衡地应对上述各类挑战。其中, 基于加密、签名和标记信息的源地址验证方案开销过重, 而基于域间路由信息的方案假阳性过大而运维风险过高, 这使得域间源地址验证的挑战正逐渐转向于方案的可部署性问题。尽管大部分验证方法主要关心互联网安全所涉及的集体利益问题, 并在一定部署规模的基础上具备较好的整体防御效力, 但方法设计中极少涉及对各个自治域的部署激励, 忽略了部署者的局部利益。自治域在缺乏利益驱动的背景下, 部署代价难以转化为经济效益, 阻碍了防御方案的部署推进。因此, 建立以部署者利益出发的可部署性评价模型, 已逐渐成为域间源地址验证的重要设计指标。



