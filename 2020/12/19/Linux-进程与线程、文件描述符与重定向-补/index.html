<!DOCTYPE html><html lang="en" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="LeeX0"><meta name="keywords" content=""><title>Linux:进程与线程、文件描述符与重定向(补) - LeeX0&#39;s blog</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/themes/prism.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-numbers/prism-line-numbers.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"leex0.top",root:"/",version:"1.8.9-a",typing:{enable:!0,typeSpeed:60,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>LeeX0's blog</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> Home</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> Archives</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> Categories</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> Tags</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> About</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/img/Royal_BluePetrol.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="Linux:进程与线程、文件描述符与重定向(补)"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> LeeX0 </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-12-19 19:35" pubdate>December 19, 2020 pm</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 1.1k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 13 分钟</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">Linux:进程与线程、文件描述符与重定向(补)</h1><div class="markdown-body"><h3 id="Q1：与Windows下进程线程区别？"><a href="#Q1：与Windows下进程线程区别？" class="headerlink" title="Q1：与Windows下进程线程区别？"></a>Q1：与Windows下进程线程区别？</h3><p>Windows中<code>进程</code>只是作为<strong>资源的拥有者</strong>，并不是实际任务的执行者，<strong>实际的执行</strong>靠<code>线程</code>实现。</p><p>一个进程可以拥有多个线程，多个线程共享进程拥有的资源，同时可能具有自己的独占资源。在具体执行任务时由线程来使用处理机。</p><p>Windows中，进程实现靠createProcess实现。而createProcess有一大堆的参数，不过很多时候都默认为null。其作用相当于创建一个进程的同时创建一个线程（一般一个）。</p><p>而Linux中<strong>在 Linux 系统中，进程和线程几乎没有区别</strong>。</p><p>进程和线程都是实际运行的存在，都有一个类似的进程描述符（而Windows中线程不具有进程描述符，只描述一些少量的独有资源，所以很轻量）。</p><p><em>线程看起来跟进程没有区别，只是线程的某些数据区域和其父进程是共享的，而子进程是拷贝副本，而不是共享</em>。</p><h3 id="Q2：如何理解Linux-shell中的“2-gt-amp-1”？"><a href="#Q2：如何理解Linux-shell中的“2-gt-amp-1”？" class="headerlink" title="Q2：如何理解Linux shell中的“2&gt;&amp;1”？"></a>Q2：如何理解Linux shell中的“2&gt;&amp;1”？</h3><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.&#x2F;test.sh  &gt; log.txt 2&gt;&amp;1</code></pre></div><p>上面的调用表明将<code>./test.sh</code>的输出重定向到<code>log.txt</code>文件中，同时将标准错误也重定向到<code>log.txt</code>文件中。</p><p>每个程序在运行后，都会至少打开三个文件描述符，分别是0：标准输入；1：标准输出；2：标准错误。例如，对于前面的test.sh脚本它至少打开了三个文件描述符（可以在<code>/proc/&lt;pid&gt;/fd</code>目录下查到）。</p><p>那么现在就容易理解前面的疑问了，<code>2&gt;&amp;1</code>表明将文件描述2（标准错误输出）的内容重定向到文件描述符1（标准输出），为什么1前面需要&amp;？当没有&amp;时，1会被认为是一个普通的文件，<strong>有&amp;表示重定向的目标不是一个文件，而是一个文件描述符</strong>。在前面我们知道，test.sh &gt;log.txt又将文件描述符1的内容重定向到了文件log.txt，那么最终标准错误也会重定向到log.txt。</p><p>可以在<code>/proc/&lt;pid&gt;/fd</code>目录下查到重定向的情况文件，<strong>文件描述符1和2都指向了log.txt文件，</strong>也就得到了我们最终想要的效果：<strong>将标准错误输出重定向到文件中</strong>。</p><blockquote><p>程序运行后会打开三个文件描述符，分别是标准输入，标准输出和标准错误输出。</p><p>在调用脚本时，可使用2&gt;&amp;1来将标准错误输出重定向。</p><p>只需要查看脚本的错误时，可将标准输出重定向到文件，而标准错误会打印在控制台，便于查看。</p><p><code>&gt;&gt;log.txt</code>会将重定向内容追加到log.txt文件末尾。</p><p>通过查看<code>/proc/&lt;pid&gt;/fd</code>下的内容，可了解进程打开的文件描述符信息。</p></blockquote><h3 id="Q3：为什么command-gt-file-2-gt-amp-1-不可以？"><a href="#Q3：为什么command-gt-file-2-gt-amp-1-不可以？" class="headerlink" title="Q3：为什么command &gt; file 2&gt;&amp;1 不可以？"></a>Q3：为什么<code>command &gt; file 2&gt;&amp;1</code>不可以？</h3><ul><li>对于<code>command &gt; file 2&gt;&amp;1</code>:</li></ul><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 初始状态
0 -&gt; &#x2F;dev&#x2F;pts&#x2F;7
1 -&gt; &#x2F;dev&#x2F;pts&#x2F;7
2 -&gt; &#x2F;dev&#x2F;pts&#x2F;7</code></pre></div><p>首先是<code>command &gt; file</code>将标准输出重定向到<code>file</code>中。</p><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># command &gt; file
0 -&gt; &#x2F;dev&#x2F;pts&#x2F;7
1 -&gt; file
2 -&gt; &#x2F;dev&#x2F;pts&#x2F;7</code></pre></div><p><code>2&gt;&amp;1</code>是标准错误拷贝了标准输出的行为，也就是同样被重定向到<code>file</code>中。</p><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 2&gt;&amp;1
0 -&gt; &#x2F;dev&#x2F;pts&#x2F;7
1 -&gt; file
2 -&gt; file</code></pre></div><p>最终结果就是标准输出和错误都被重定向到file中，正确。</p><ul><li>而对于<code>command 2&gt;&amp;1 &gt;file 2&gt;&amp;1</code>:</li></ul><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 初始状态
0 -&gt; &#x2F;dev&#x2F;pts&#x2F;7
1 -&gt; &#x2F;dev&#x2F;pts&#x2F;7
2 -&gt; &#x2F;dev&#x2F;pts&#x2F;7</code></pre></div><p>首先是<code>2&gt;&amp;1</code>，<strong>标准错误拷贝了标准输出的行为，但此时标准输出还是在终端</strong>。</p><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 2&gt;&amp;1
0 -&gt; &#x2F;dev&#x2F;pts&#x2F;7
1 -&gt; &#x2F;dev&#x2F;pts&#x2F;7
2 -&gt; &#x2F;dev&#x2F;pts&#x2F;7</code></pre></div><p><code>&gt;file</code>后输出才被重定向到file，但标准错误仍然保持在终端。</p><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 2&gt;&amp;1
0 -&gt; &#x2F;dev&#x2F;pts&#x2F;7
1 -&gt; file
2 -&gt; &#x2F;dev&#x2F;pts&#x2F;7</code></pre></div><p>所以达不到标准错误输出重定向的效果。</p><blockquote><p>参考：</p><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/47765176">https://zhuanlan.zhihu.com/p/47765176</a></p></blockquote></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/Linux/">Linux</a> <a class="hover-with-bg" href="/tags/%E8%BF%9B%E7%A8%8B/">进程</a> <a class="hover-with-bg" href="/tags/%E7%BA%BF%E7%A8%8B/">线程</a> <a class="hover-with-bg" href="/tags/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6/">文件描述符</a> <a class="hover-with-bg" href="/tags/%E9%87%8D%E5%AE%9A%E5%90%91/">重定向</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/2020/12/24/%E3%80%8A%E5%81%87%E9%9D%A2%E5%B1%B1%E5%BA%84%E3%80%8B%E6%91%98%E5%BD%95/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">《假面山庄》摘录</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/2020/12/18/Linux-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B%E3%80%81%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/"><span class="hidden-mobile">Linux:进程与线程、文件描述符与重定向</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-core.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/autoloader/prism-autoloader.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>$("#local-search-input").on("click",(function(){searchFunc("/local-search.xml","local-search-input","local-search-result")})),$("#modalSearch").on("shown.bs.modal",(function(){$("#local-search-input").focus()}))</script><script src="/js/boot.js"></script></body></html>